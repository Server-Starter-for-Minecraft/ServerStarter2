# v2

v2 は 2024.05- のバックエンドのリファクタリングに際して作成した処理群です

ここではバックエンドの構成について記します。
なお、このドキュメントはふわふわ設計段階の理想論なので、現実に即していない可能性があります。

# フォルダ構成

v2ではディレクトリごとに役目を分けています

### v2/util

様々な汎用処理を記載します。
この処理はバックエンドのどこからでも呼んで問題ありません。

既存のライブラリを使用する際に、一度v2/utilを挟むのもいいでしょう。

細かい内容は v2/util/readme.md に記載してあります。

## v2/type

バックエンドで汎用的に使用する可能性のある型定義を記載します。
ここには実装は書きません。

v2/source から v2/api まで流れる可能性のあるデータの定義等はここに切り出しましょう。

一部 schema の再実装になるかもしれませんが問題ないのでこっちに書きましょう。

### v2/api

フロントエンドとの橋渡しを担当します。
APIをなるべく保ったまバックエンドを改修できることが目的です。

フロントエンド空のデータを適切に加工してコアロジックを呼びだすための薄いレイヤです。

v2/util v2/core /ipc 以外のモジュールが必要になった場合は、coreに処理を切り出すべきでしょう。


### v2/core

コアロジックを記述します。

ここでは複数のv2/apiと複数のv2/sourceをつなぐ、システムのメイン部分です。

v2/util v2/source v2/api 以外のモジュールが必要になった場合は、処理を適切に分離するべきでしょう。

基本的に仕様と呼ばれるような処理はここにまとまることになるでしょう。


### v2/source
ワールドデータ、設定ファイル、サーバーデータ等、システムの外側のデータを扱うための処理群です。

外部データの読み書き、整合性の担保、データの修復等に責任を持ちます。

v2/coreから上のレイヤがデータのあり方について考えなくて済むような実装を行いましょう。

ワールドの保存場所をローカルからGdriveに変更！ みたいなときにv2/coreの修正が最小限になるように構成しましょう。

source間で依存関係ができるのは問題ありませんが、
その依存関係が本当にそのsourceにとって必須なのかは考えて実装しましょう。
